<!DOCTYPE>
<html>
    <header>
        <link rel="stylesheet" style="text/css" href="style.css"/>
        <title> Nyx | Bouncy </title>
    </header>
    <style>
      svg {
        position: absolute;
        top: 0; left: 0;
        pointer-events: none; /* donâ€™t block clicks */
      }
    </style>
    <body>
        <header-component></header-component>
        <main>
            <leftbar-component></leftbar-component>
            <div class="content">
                <div id="ball" class="circle2">
                    <div class="circle"></div>
                </div>
                <svg id="line-layer"></svg>
            </div>
            <rightbar-component></rightbar-component>
        </main>
        <div id="distance-display" style="position: fixed;"><span id=distance></span></div>
    </body>
    <script>
        const el = document.getElementById("ball");
        const svg = document.getElementById("line-layer");
        const distanceDisplay = document.getElementById("distance-display");
        const distance = document.getElementById("distance");
        let {top: y, left: x, width: w, height: h} = el.getBoundingClientRect();

        let vy = 0, vx = 0, rafId = 0, prevTs;
        let d = 0;

        let targetY = 0, targetX =0;
        const K = 10, c = 0.2;


        window.addEventListener("mousemove", (e) => {

            targetX = e.clientX;
            targetY = e.clientY;

            distanceDisplay.style.top = targetY - 10;
            distanceDisplay.style.left = targetX + 20;

            if (!rafId) rafId = requestAnimationFrame(tick);
        }, { passive: true });
        
        function drawLine() {
            // get center points
            const x1 = x;
            const y1 = y;

            svg.setAttribute("width", window.innerWidth);
            svg.setAttribute("height", window.innerHeight);
            svg.innerHTML = `<line x1="${x1}" y1="${y1}" x2="${targetX}" y2="${targetY}" stroke="var(--clr-neon-yellow)" stroke-width="2"/>`;
        }

        function tick(ts) {
            rafId = 0;

            if (!prevTs) prevTs = ts;
            const dt = Math.min((ts - prevTs) / 1000, 0.05);
            prevTs = ts;

            const dy = targetY - y;
            const dx = targetX - x;

            d = Math.sqrt(Math.pow(dx,2) + Math.pow(dy,2)).toFixed(0)
            distance.textContent = d

            const ay = K * dy - c * vy;
            const ax = K * dx - c * vx;

            vy += dt * ay;
            vx += dt * ax;
            y  += dt * vy;
            x  += dt * vx;

            el.style.transform = `translate(-50%, -50%) translate(${x.toFixed(2)}px, ${y.toFixed(2)}px)`;
            drawLine();
            
            if (Math.abs(dy) > 10 || Math.abs(vy) > 10 || Math.abs(dx) > 10 || Math.abs(vy) > 10) {
                rafId = requestAnimationFrame(tick);
            } else {
                rafId = null;
            }
        }

    </script>
    <script src="components/header.js"></script>
    <script src="components/leftbar.js"></script>
    <script src="components/rightbar.js"></script>
</html>


